<script type="text/html" data-help-name="mcu_color">
    <p>A node that reads color values from M5Stack Color Unit (TCS3472 sensor) via I2C with configurable output modes.</p>
    
    <h3>Outputs</h3>
    <p>The outputs depend on the selected output mode:</p>
    
    <h4>Raw Values Mode</h4>
    <dl class="message-properties">
        <dt>Output 1 - Red</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">number</span></dt>
                <dd>Raw red color component value from 0 to 65535</dd>
            </dl>
        </dd>
        
        <dt>Output 2 - Green</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">number</span></dt>
                <dd>Raw green color component value from 0 to 65535</dd>
            </dl>
        </dd>
        
        <dt>Output 3 - Blue</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">number</span></dt>
                <dd>Raw blue color component value from 0 to 65535</dd>
            </dl>
        </dd>
        
        <dt>Output 4 - Clear</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">number</span></dt>
                <dd>Raw clear channel value from 0 to 65535 for ambient light measurement</dd>
            </dl>
        </dd>
    </dl>
    
    <h4>RGB Values Mode</h4>
    <dl class="message-properties">
        <dt>Output 1 - Red (0-255)</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">number</span></dt>
                <dd>Calibrated red color component value from 0 to 255</dd>
            </dl>
        </dd>
        
        <dt>Output 2 - Green (0-255)</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">number</span></dt>
                <dd>Calibrated green color component value from 0 to 255</dd>
            </dl>
        </dd>
        
        <dt>Output 3 - Blue (0-255)</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">number</span></dt>
                <dd>Calibrated blue color component value from 0 to 255</dd>
            </dl>
        </dd>
        
        <dt>Output 4 - RGB String</dt>
        <dd>
            <dl class="message-properties">
                <dt>payload <span class="property-type">string</span></dt>
                <dd>CSS RGB string format: "rgb(r,g,b)" for direct use in dashboards</dd>
            </dl>
        </dd>
    </dl>
    
    <h3>Configuration</h3>
    <dl class="message-properties">
        <dt>SDA Pin</dt>
        <dd>I2C data pin (default: 21)</dd>
        
        <dt>SCL Pin</dt>
        <dd>I2C clock pin (default: 22)</dd>
        
        <dt>Output Mode</dt>
        <dd>Select between "Raw Values" or "RGB Values" output modes</dd>
        
        <dt>Calibration (RGB Mode only)</dt>
        <dd>
            <p>Black and White reference values for color calibration:</p>
            <ul>
                <li><strong>Black Reference:</strong> RGB values when sensor is against a black surface</li>
                <li><strong>White Reference:</strong> RGB values when sensor is against a white surface</li>
            </ul>
            <p>Proper calibration ensures accurate color representation in RGB mode.</p>
        </dd>
    </dl>
    
    <h3>Details</h3>
    <p>This node communicates with the TCS3472 color sensor in the M5Stack Color Unit via I2C (address 0x29).</p>
    
    <p><strong>Raw Values Mode:</strong> Provides raw RGBC color readings as 16-bit values directly from the sensor 
    without any normalization or processing, suitable for applications requiring precise color measurement data.</p>
    
    <p><strong>RGB Values Mode:</strong> Provides calibrated RGB values normalized to 0-255 range using black and white 
    reference points. This mode is ideal for dashboard displays and general color applications.</p>
    
    <h3>Calibration Process</h3>
    <p>To calibrate the sensor for RGB mode:</p>
    <ol>
        <li>Set the node to Raw Values mode temporarily</li>
        <li>Place the sensor against a black surface and note the RGB values</li>
        <li>Place the sensor against a white surface and note the RGB values</li>
        <li>Switch to RGB Values mode and enter these values in the calibration fields</li>
        <li>Deploy the flow to apply the calibration</li>
    </ol>
</script>
    
    <p>The sensor is automatically initialized when first used with a 154ms integration time and 4x gain for optimal
    color detection. Send any message to trigger a color reading. The raw data output allows for custom processing
    and calibration in your application.</p>
</script>
